# 빅데이터는 수집, 정제, 적재, 분석, 시각화의 여러 단계를 거칩니다. 이 단계를 거치는 동안 여러가지 기술을 이용하여 처리되고, 이 기술들을 통틀어 빅데이터 에코 시스템(Bigdata Eco System)이라고 합니다.

## Hadoop ?
- 하둡은 2006년 야후의 더그 커팅이 '넛치'라는 검색엔진을 개발하는 과정에서 대용량의 비정형 데이터를 기존의 RDB 기술로는 처리가 힘들다는 것을 깨닫고, 새로운 기술을 찾는 중 구글에서 발표한 GFS와 MapReduce 관련 논문을 참고하여 개발하였습니다. 이후 아파치 재단의 오픈 소스로 공개 되었습니다. 하둡은 하나의 성능 좋은 컴퓨터를 이용하여 데이터를 처리하는 대신, 적당한 성능의 범용 컴퓨터 여러 대를 클러스터화하고, 큰 크기의 데이터를 클러스터에서 병렬로 동시에 처리하여 처리 속도를 높이는 것을 목적으로 하는 분산처리를 위한 오픈소스 프레임워크라고 할 수 있습니다.

 ## 구성 요소
- Hadoop Common
* 하둡의 다른 모듈을 지원하기 위한 공통 컴포넌트 모듈
- Hadoop HDFS
* 분산저장을 처리하기 위한 모듈
* 여러개의 서버를 하나의 서버처럼 묶어서 데이터를 저장
- Hadoop YARN
* 병렬처리를 위한 클러스터 자원관리 및 스케줄링 담당
- Hadoop Mapreduce
* 분산되어 저장된 데이터를 병렬 처리할 수 있게 해주는 분산 처리 모듈
- Hadoop Ozone
* 하둡을 위한 오브젝트 저장소

  ## 장단점
- 장점
* 오픈소스로 라이선스에 대한 비용 부담이 적음
* 시스템을 중단하지 않고, 장비의 추가가 용이(Scale Out)
* 일부 장비에 장애가 발생하더라도 전체 시스템 사용성에 영향이 적음(Fault tolerance)
* 저렴한 구축 비용과 비용대비 빠른 데이터 처리
* 오프라인 배치 프로세싱에 최적화
- 단점
* HDFS에 저장된 데이터를 변경 불가
* 실시간 데이터 분석 같이 신속하게 처리해야 하는 작업에는 부적합
* 너무 많은 버전과 부실한 서포트
* 설정의 어려움


## 구조
- HDFS는 마스터 슬레이브 구조로 하나의 네임노드와 여러 개의 데이터노드로 구성됩니다. 네임노드는 메타데이터를 가지고 있고, 데이터는 블록 단위로 나누어 데이터노드에 저장됩니다. 사용자는 네임노드를 이용해 데이터를 쓰고, 읽을 수 있습니다.
- 네임노드의 주요 역할은 메타데이터 관리와 데이터노드의 관리입니다.
- 메타데이터는 파일이름, 파일크기, 파일생성시간, 파일접근권한, 파일 소유자 및 그룹 소유자, 파일이 위치한 블록의 정보 등으로 구성됩니다.
- 데이타노드는 파일을 저장하는 역할을 합니다. 파일은 블록단위로 저장됩니다. 데이타노드는 주기적으로 네임노드에 하트비트와 블록리포트를 전달합니다. 하트비트는 데이타노드의 동작여부를 판단하는데 이용됩니다.

## 블록 추상화의 이점
- 첫 번째는 파일 하나의 크기가 단일 디스크의 용량보다 더 커질 수 있습니다.
- 두 번째는 파일 단위보다 블록 단위로 추상화를 하면 스토리지의 서브 시스템을 단순하게 만들 수 있다는 것입니다.
- 세번째는 내고장성을 제공하는데 필요한 복제(replication)을 구현할 때 매우 적합합니다. 블

## 블록 지역성
- 맵리듀스를 이용한 분산 컴퓨팅은 블록의 지역성을 이용해 성능을 높입니다.

## 블록 캐싱
- 데이터 노드에 저장된 데이터 중 자주 읽는 블록은 블록 캐시(block cache)라는 데이터 노드의 메모리에 명시적으로 캐싱할 수 있습니다. 파일 단위로 캐싱 할 수도 있어서 조인에 사용되는 데이터들을 등록하여 읽기 성능을 높일 수 있습니다.

## 세컨더리 네임노드
- 네임노드가 구동되고 나면 Edits 파일이 주기적으로 생성됩니다. 네임노드의 트랜잭션이 빈번하면 빠른 속도로 Edits 파일이 생성됩니다.
- 이는 네임노드의 디스크 부족 문제를 생성할 수도 있고, 네임노드가 재구동 되는 시간을 느려지게 할 수도 있습니다.
- 세컨더리 네임노드는 Fsimage와 Edits 파일을 주기적으로 머지하여 최신 블록의 상태로 파일을 생성합니다.


## HDFS 고가용성
- HDFS는 네임노드가 단일 실패 지점입니다. 네임노드에 문제가 발생하면 모든 작업이 중지되고, 파일을 읽거나 쓸수 없게 됩니다. 하둡 v2에서 이 문제를 해결하기 위해서 HDFS 고가용성(High Availability)을 제공합니다.
- HDFS 고가용성은 이중화된 두대의 서버인 액티브(active) 네임노드와 스탠바이(standby) 네임노드를 이용하여 지원합니다. 액티브 네임노드와 스탠바이 네임노드는 데이터 노드로부터 블록 리포트와 하트비트를 모두 받아서 동일한 메타데이터를 유지하고, 공유 스토리지를 이용하여 에디트파일을 공유합니다.


## HDFS 데이터 블록 관리
- HDFS 운영중 데이터 노드에 문제가 생기면, 데이터 블록에 문제가 발생 할 수 있습니다. 커럽트(CORRUPT) 상태와 복제 개수 부족(Under replicated) 상태 입니다.
- HDFS는 하트비트를 통해 데이터 블록에 문제가 생기는 것을 감지하고 자동으로 복구를 진행합니다. 다른 데이터 노드에 복제된 데이터를 가져와서 복구합니다.


## HDFS 암호화
- HDFS는 민감정보의 보안을 위해 암호화 기능을 제공1합니다. 암호화를 적용하면 디스크에 저장되는 파일을 암호화하여 저장하고, HDFS의 디렉토리에 접근할 때 하둡 KMS를 이용하여 키기반으로 전송 데이터의 암/복호화를 지원합니다.\


## 밸런서
- HDFS를 운영하면서 데이터 불균형이 발생하여 밸런싱을 실행해야 하는 경우가 있습니다.
- 밸런서는 다음과 같이 실행합니다. 상황에 따라 작업 시간이 굉장히 오래걸릴 수도 있습니다.
  > ```
  > $ hdfs balancer -threshold 5
  > Time Stamp               Iteration#  Bytes Already Moved  Bytes Left To Move  Bytes Being Moved  NameNode
  > Nov 7, 2022 6:50:16 AM            0              4.23 GB            14.96 GB              10 GB  hdfs://hdfs-namenode:8020
  > Nov 7, 2022 7:06:49 AM            1              9.96 GB             9.63 GB              10 GB  hdfs://hdfs-namenode:8020
  > Nov 7, 2022 7:22:56 AM            2             15.53 GB             4.23 GB            8.77 GB  hdfs://hdfs-namenode:8020
  > The cluster is balanced. Exiting...
  > Nov 7, 2022 7:23:05 AM            3             15.53 GB                 0 B                0 B  hdfs://hdfs-namenode:8020
  > Nov 7, 2022 7:23:05 AM   Balancing took 44.9548 minutes
  > ```
